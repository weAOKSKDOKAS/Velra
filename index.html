<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VELRA Terminal</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#070707;
      --card:#0c0c0c;
      --card2:#0a0a0a;
      --line:rgba(255,255,255,.14);
      --line2:rgba(255,255,255,.10);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.58);
      --muted2:rgba(255,255,255,.45);
      --yellow:#f5c84c;
      --yellow2:#d2a93d;
      --green:#33d17a;
      --red:#ff5a5a;
    }
    html,body{height:100%;}
    body{
      background: radial-gradient(1100px 520px at 40% -10%, rgba(245,200,76,.10), transparent 55%),
                  radial-gradient(900px 520px at 85% 10%, rgba(245,200,76,.06), transparent 55%),
                  var(--bg);
      color:var(--txt);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      letter-spacing:.2px;
    }
    .serifTitle{
      font-family:Fraunces, ui-serif, Georgia, serif;
      font-style:normal;           /* stop italic spam */
      letter-spacing:.2px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
    }
    .subtleLine{ border-top:1px solid var(--line2); }

    .pill{
      border:1px solid rgba(245,200,76,.35);
      color:rgba(245,200,76,.95);
      background:rgba(245,200,76,.07);
      border-radius:999px;
      font-weight:700;
      letter-spacing:.18em;
      font-size:.70rem;
      padding:.34rem .7rem;
    }
    .chip{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.03);
      border-radius:999px;
      padding:.45rem .65rem;
      color:rgba(255,255,255,.80);
      font-weight:600;
      font-size:.78rem;
      display:inline-flex;
      gap:.4rem;
      align-items:center;
    }

    /* Left nav */
    .navBox{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--line);
      border-radius:18px;
      overflow:hidden;
    }
    .navTitle{
      padding:.95rem 1.05rem;
      font-size:.72rem;
      letter-spacing:.18em;
      font-weight:800;
      color:rgba(245,200,76,.9);
      display:flex;
      gap:.55rem;
      align-items:center;
      background:rgba(0,0,0,.25);
      border-bottom:1px solid var(--line2);
    }
    .navItem{
      width:100%;
      text-align:left;
      padding:.9rem 1.05rem;
      border-bottom:1px solid rgba(255,255,255,.06);
      color:rgba(255,255,255,.78);
      font-weight:650;
      transition: all .14s ease;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .navItem:hover{ background: rgba(255,255,255,.03); }
    .navItem.active{
      background: rgba(245,200,76,.12);
      color: rgba(255,255,255,.95);
      border-left:3px solid var(--yellow);
    }
    .dot{
      width:7px;height:7px;border-radius:999px;background:rgba(245,200,76,.65);
    }

    /* Breaking ticker */
    .breakingWrap{
      border-top:1px solid rgba(255,255,255,.08);
      border-bottom:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.55);
      overflow:hidden;
    }
    .breakingInner{
      display:flex;
      gap:1rem;
      align-items:center;
      white-space:nowrap;
      will-change:transform;
      animation: ticker 120s linear infinite; /* slower */
      padding:.55rem 0;
    }
    .breakingInner:hover{ animation-play-state: paused; }
    @keyframes ticker{
      0%{ transform: translateX(0); }
      100%{ transform: translateX(-50%); }
    }
    .breakingBadge{
      margin-left:1rem;
      padding:.33rem .7rem;
      border-radius:999px;
      background: rgba(245,200,76,.12);
      border:1px solid rgba(245,200,76,.35);
      color: rgba(245,200,76,.95);
      font-weight:800;
      letter-spacing:.15em;
      font-size:.70rem;
      flex:0 0 auto;
    }
    .tickItem{
      color:rgba(255,255,255,.78);
      font-weight:650;
      font-size:.82rem;
      padding-right:2rem;
      border-right:1px solid rgba(255,255,255,.10);
    }
    .tickTime{
      color: rgba(245,200,76,.9);
      font-weight:800;
      margin-right:.35rem;
    }

    /* Wire cards */
    .wireCard{
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:1.05rem 1.05rem .95rem;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      cursor:pointer;
    }
    .wireCard:hover{
      transform: translateY(-2px);
      border-color: rgba(245,200,76,.28);
      background: rgba(255,255,255,.03);
    }
    .impactTag{
      font-size:.64rem;
      letter-spacing:.18em;
      font-weight:900;
      padding:.20rem .48rem;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.16);
      display:inline-flex;
      align-items:center;
      gap:.35rem;
    }
    .impactHigh{ color: rgba(255,90,90,.95); border-color: rgba(255,90,90,.25); background: rgba(255,90,90,.07); }
    .impactMed{ color: rgba(245,200,76,.95); border-color: rgba(245,200,76,.25); background: rgba(245,200,76,.07); }
    .impactLow{ color: rgba(51,209,122,.95); border-color: rgba(51,209,122,.25); background: rgba(51,209,122,.07); }

    .wireTitle{
      font-family: Inter, system-ui, sans-serif; /* no italic */
      font-weight:800;
      font-size:1.02rem;
      line-height:1.25;
      margin-top:.55rem;
      color: rgba(255,255,255,.92);
    }
    .wireMeta{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:.5rem;
      font-size:.72rem;
      color: rgba(255,255,255,.50);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .wireKp{
      margin-top:.75rem;
      color: rgba(255,255,255,.72);
      font-size:.85rem;
      line-height:1.45;
    }
    .wireKp li{ margin:.28rem 0; }

    /* Modal */
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.72);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
      padding:20px;
    }
    .modalBackdrop.show{ display:flex; }
    .modalPanel{
      width: min(1040px, calc(100vw - 34px)); /* wider */
      max-height: min(92vh, 920px);
      overflow:auto;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(10,10,10,.92);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
    }
    .modalHeader{
      position:sticky; top:0;
      background: rgba(10,10,10,.92);
      border-bottom:1px solid rgba(255,255,255,.10);
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between;
      z-index:2;
    }
    .closeBtn{
      border:1px solid rgba(255,255,255,.16);
      padding:.45rem .75rem;
      border-radius:10px;
      font-weight:800;
      color: rgba(255,255,255,.80);
      background: rgba(255,255,255,.03);
    }
    .closeBtn:hover{ border-color: rgba(245,200,76,.28); }
    .modalBody{ padding:16px 16px 18px; }
    .imgBox{
      width:100%;
      height: 280px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: radial-gradient(700px 240px at 35% 20%, rgba(245,200,76,.20), transparent 55%),
                  linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      overflow:hidden;
    }
    .imgBox img{ width:100%; height:100%; object-fit:cover; }
    .modalH1{
      font-size:1.55rem;
      line-height:1.15;
      font-weight:900;
      margin-top:14px;
      color: rgba(255,255,255,.94);
    }
    .takeawayTitle{
      margin-top:14px;
      font-weight:900;
      letter-spacing:.12em;
      color: rgba(245,200,76,.95);
      font-size:.75rem;
      text-transform:uppercase;
    }
    .storyTitle{
      margin-top:16px;
      font-weight:900;
      letter-spacing:.12em;
      color: rgba(245,200,76,.95);
      font-size:.75rem;
      text-transform:uppercase;
    }
    .modalText{
      color: rgba(255,255,255,.80);
      line-height:1.65;
      font-size:.95rem;
      margin-top:10px;
      white-space:pre-wrap;
    }
    .srcBox{
      margin-top:14px;
      padding-top:12px;
      border-top:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.62);
      font-size:.85rem;
    }
    .srcBox a{
      color: rgba(245,200,76,.95);
      font-weight:800;
      text-decoration: underline;
      text-decoration-color: rgba(245,200,76,.45);
    }

    /* Brief carousel */
    .briefNav{
      display:flex; align-items:center; gap:.5rem; flex-wrap:wrap;
    }
    .briefBtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.84);
      font-weight:900;
      padding:.45rem .7rem;
      border-radius:10px;
      font-size:.84rem;
    }
    .briefBtn:hover{ border-color: rgba(245,200,76,.28); }
    .briefIdx{
      color: rgba(255,255,255,.62);
      font-weight:800;
      font-size:.85rem;
      margin:0 .25rem;
    }
    .briefSlideTitle{
      font-weight:900;
      font-size:1.25rem;
      margin-top:.25rem;
    }
    .briefTable{
      margin-top:12px;
      width:100%;
      border-collapse:collapse;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
    }
    .briefTable th, .briefTable td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-size:.9rem;
    }
    .briefTable th{
      color: rgba(245,200,76,.95);
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:.72rem;
      background: rgba(0,0,0,.35);
    }
    .briefTable td{ color: rgba(255,255,255,.82); }

    /* Brief scroll layout (v2) */
    .briefKicker{
      color: rgba(245,200,76,.95);
      font-weight:900;
      letter-spacing:.18em;
      font-size:.70rem;
      text-transform:uppercase;
    }
    .briefTitle{
      font-weight:950;
      font-size:1.45rem;
      margin-top:.25rem;
      line-height:1.1;
    }
    .briefLede{
      margin-top:.65rem;
      color: rgba(255,255,255,.80);
      line-height:1.55;
      font-size:.95rem;
    }
    .briefSectionTitle{
      margin-top:1.25rem;
      font-weight:950;
      letter-spacing:.04em;
      font-size:1.05rem;
    }
    .gridCards{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:12px;
      margin-top:.75rem;
    }
    .briefCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px 12px 11px;
    }
    .briefCardTitle{
      font-weight:900;
      color: rgba(255,255,255,.92);
      line-height:1.2;
    }
    .briefCardText{
      color: rgba(255,255,255,.72);
      font-size:.9rem;
      line-height:1.45;
      margin-top:.45rem;
    }
    .kpiGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap:10px;
      margin-top:.75rem;
    }
    .kpiLabel{ color: rgba(255,255,255,.55); font-weight:900; font-size:.72rem; letter-spacing:.14em; text-transform:uppercase; }
    .kpiValue{ font-weight:950; font-size:1.05rem; margin-top:.25rem; }
    .kpiDelta{ color: rgba(255,255,255,.70); font-weight:850; font-size:.85rem; margin-top:.15rem; }

    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top:.75rem;
    }
    @media (max-width: 780px){
      .twoCol{ grid-template-columns: 1fr; }
    }

    .barRow{ display:flex; align-items:center; gap:10px; margin-top:.55rem; }
    .barLabel{ width:110px; color: rgba(255,255,255,.70); font-weight:850; font-size:.85rem; }
    .barTrack{ flex:1; height:10px; border-radius:999px; background: rgba(255,255,255,.08); overflow:hidden; border:1px solid rgba(255,255,255,.10); }
    .barFill{ height:100%; border-radius:999px; background: rgba(245,200,76,.65); }
    .barVal{ width:120px; text-align:right; color: rgba(255,255,255,.78); font-weight:850; font-size:.85rem; }

    .miniBtn{
      margin-top:.6rem;
      border:1px solid rgba(245,200,76,.28);
      background: rgba(245,200,76,.08);
      color: rgba(245,200,76,.95);
      font-weight:900;
      border-radius:10px;
      padding:.4rem .6rem;
      font-size:.78rem;
      letter-spacing:.06em;
    }
    .miniBtn:hover{ border-color: rgba(245,200,76,.45); }

    .tickerChip{ display:flex; align-items:center; gap:.5rem; font-weight:900; }
    .tickerLogo{
      width:22px; height:22px; border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(245,200,76,.14);
      border:1px solid rgba(245,200,76,.28);
      color: rgba(245,200,76,.95);
      font-size:.72rem;
      line-height:1;
      flex:0 0 auto;
    }
  </style>
</head>

<body>
  <div class="w-full">
    <div class="px-6 pt-5 pb-4">
      <div class="flex items-center justify-between">
        <div class="flex items-end gap-4">
          <div class="text-[1.15rem] font-black tracking-[.22em]">
            <span class="text-[var(--yellow)]">VELRA</span> <span class="text-white">TERMINAL</span>
          </div>
          <div class="text-xs tracking-[.22em] text-white/50 font-extrabold">
            MARKET INTEL v4.4
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div class="flex items-center gap-2 text-xs tracking-[.22em] font-extrabold text-white/65">
            <span class="inline-block w-2 h-2 rounded-full bg-[var(--green)]"></span>
            ONLINE
          </div>
          <button id="btnReconnect" class="border border-white/15 bg-white/5 hover:border-[rgba(245,200,76,.28)] text-white/80 font-extrabold tracking-[.18em] text-[.70rem] px-3 py-2 rounded-lg">
            RECONNECT
          </button>
          <div class="text-xs tracking-[.18em] text-white/45 font-extrabold">
            UPDATED: <span id="lastUpdated">—</span>
          </div>
        </div>
      </div>
    </div>

    <div class="breakingWrap">
      <div class="flex items-center gap-3">
        <div class="breakingBadge">BREAKING NEWS</div>
        <div class="w-full overflow-hidden">
          <div class="breakingInner" id="tickerTrack"></div>
        </div>
      </div>
    </div>

    <div class="p-6 grid grid-cols-[260px_1fr] gap-6">
      <!-- LEFT -->
      <aside class="space-y-5">
        <div class="navBox">
          <div class="navTitle">
            <span class="dot"></span>
            WILAYAH PASAR
          </div>
          <div id="regionNav"></div>
        </div>

        <div class="navBox">
          <div class="navTitle">
            <span class="dot" style="background:rgba(255,255,255,.38)"></span>
            FILTER SEKTOR
          </div>
          <div id="sectorNav"></div>
        </div>
      </aside>

      <!-- MAIN -->
      <section class="space-y-6">
        <!-- TOP GRID -->
        <div class="grid grid-cols-12 gap-6">
          <!-- BRIEF -->
          <div class="col-span-8 card p-6" id="briefCard">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="flex items-center gap-3 flex-wrap">
                  <span class="pill" id="briefLabel">MORNING BRIEFING</span>
                  <div class="text-xs tracking-[.22em] font-extrabold text-white/55" id="briefPath">—</div>
                </div>
              </div>
              <button id="btnOpenBrief" class="briefBtn hidden">OPEN BRIEF</button>
            </div>

            <div class="mt-5">
              <div class="serifTitle text-[3.0rem] leading-[.95] font-extrabold" id="briefTitle">Market Update</div>
              <div class="mt-4 text-white/75 space-y-2" id="briefBullets"></div>
              <div class="mt-5 subtleLine pt-4">
                <div class="text-xs tracking-[.22em] font-extrabold text-white/40">WATCHLIST</div>
                <div class="mt-3 flex flex-wrap gap-2" id="briefWatchlist"></div>
              </div>
            </div>
          </div>

          <!-- MACRO -->
          <div class="col-span-4 card p-5" id="macroCard">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-xs tracking-[.22em] font-extrabold text-[var(--yellow)]">DATA MAKRO</div>
                <div class="text-xs tracking-[.22em] font-extrabold text-white/45 mt-1" id="macroPath">—</div>
              </div>
              <div class="flex items-center gap-2">
                <button class="briefBtn" id="macroTabMetric">METRIK</button>
                <button class="briefBtn" id="macroTabTrend">TREN</button>
                <button class="briefBtn" id="macroTabNext">NEXT</button>
              </div>
            </div>

            <div class="mt-4 subtleLine pt-4">
              <div class="grid grid-cols-4 gap-2 text-[.68rem] tracking-[.18em] font-extrabold text-white/45">
                <div>METRIK</div><div class="text-right">SBLM</div><div class="text-right">FCAST</div><div class="text-right">AKT</div>
              </div>
              <div class="mt-3 text-white/45 text-sm" id="macroBody">Menunggu data makro…</div>
            </div>

            <div class="mt-5 subtleLine pt-4 text-[.70rem] tracking-[.22em] font-extrabold text-white/35">
              SOURCE: INTERNAL SNAPSHOT
            </div>
          </div>
        </div>

        <!-- KEY INDICATORS (FULL WIDTH) -->
        <div class="card p-5">
          <div class="flex items-center justify-between">
            <div class="text-xs tracking-[.22em] font-extrabold text-[var(--yellow)]">KEY INDICATORS</div>
            <div class="text-xs tracking-[.18em] font-extrabold text-white/45" id="indAsOf">—</div>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-4" id="indicatorsGrid"></div>
        </div>

        <!-- WIRE -->
        <div class="card p-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="serifTitle text-[2.1rem] font-extrabold" id="wireTitle">Wire</div>
              <div class="mt-1 text-xs tracking-[.22em] font-extrabold text-white/45" id="wireMeta">—</div>
            </div>
            <div class="flex items-center gap-2">
              <button class="briefBtn" id="wireSortLatest">LATEST</button>
              <button class="briefBtn" id="wireSortImpact">IMPACT</button>
            </div>
          </div>

          <div class="mt-5 subtleLine pt-5">
            <div class="grid grid-cols-3 gap-4" id="wireGrid"></div>
            <div class="mt-4 text-white/45 text-sm hidden" id="wireEmpty">Tidak ada update signifikan ≤24 jam.</div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- MODAL (news + brief) -->
  <div class="modalBackdrop" id="modalBackdrop">
    <div class="modalPanel">
      <div class="modalHeader">
        <div class="text-xs tracking-[.22em] font-extrabold text-white/55" id="modalKicker">—</div>
        <div class="flex items-center gap-2" id="modalHeaderRight">
          <button class="closeBtn" id="modalCloseBtn">CLOSE</button>
        </div>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

  
<script>
const REGION_META = {
  INDONESIA: { label: "Indonesia" },
  USA: { label: "Amerika Serikat" },
  ASIA: { label: "Asia" },
  EUROPE: { label: "Eropa" },
};

const SECTOR_META = {
  GENERAL: "Umum",
  TECHNOLOGY: "Teknologi",
  FINANCE: "Keuangan",
  MINING_ENERGY: "Tambang & Energi",
  HEALTHCARE: "Kesehatan",
  REGULATION: "Regulasi",
  CONSUMER: "Konsumen",
};

const REGIONS = Object.keys(REGION_META);
const SECTORS = Object.keys(SECTOR_META);

const state = {
  region: "INDONESIA",
  sector: "GENERAL",
  sort: "latest",   // latest | impact
  macroTab: "metric", // metric | trend | next
  data: null,
  open: null,       // {type:"brief", region} | {type:"news", item}
};

const el = (id) => document.getElementById(id);

function safeDate(x){
  try { const d = new Date(x); return isNaN(d) ? null : d; } catch { return null; }
}
function esc(s){ return String(s ?? "").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function stripHtml(s){ return String(s ?? "").replace(/<[^>]*>/g, " ").replace(/\s+/g," ").trim(); }

function impactRank(v){
  const x = String(v||"").toUpperCase();
  if (x === "HIGH") return 3;
  if (x === "MEDIUM") return 2;
  if (x === "LOW") return 1;
  return 0;
}

function normalizeData(raw){
  const d = raw || {};
  d.generatedAt = d.generatedAt || d.generated_at_wib || d.generated_at || null;

  d.indices = d.indices || {};
  d.indicators = d.indicators || d.indices || {};
  delete d.indices?.AMERICAS;
  delete d.indicators?.AMERICAS;

  d.livewire = Array.isArray(d.livewire) ? d.livewire : [];
  d.livewire = d.livewire
    .filter(x => x && REGIONS.includes(x.region) && SECTORS.includes(x.sector))
    .map(x => ({
      id: String(x.id || ""),
      region: x.region,
      sector: x.sector,
      impact: String(x.impact || "MEDIUM").toUpperCase(),
      headline: String(x.headline || x.title || "").trim(),
      keypoints: Array.isArray(x.keypoints) ? x.keypoints.map(String).filter(Boolean).slice(0,3) : [],
      publishedAt: x.publishedAt || x.published_at || null,
      sources: Array.isArray(x.sources) ? x.sources : [],
      story: x.story || x.body || "",
      category: x.category || null,
    }))
    .filter(x => x.headline);

  // briefings: region + sector digests
  d.briefings = d.briefings || {};
  if (!d.briefings.regions) {
    // Migrate old shapes best-effort
    const reg = {};
    const legacyMap = { indonesia:"INDONESIA", usa:"USA", asia:"ASIA", europe:"EUROPE" };
    for (const [k,v] of Object.entries(d.briefings)) {
      if (!legacyMap[k]) continue;
      const r = legacyMap[k];
      reg[r] = reg[r] || {};
      reg[r].GENERAL = {
        title: v?.title || "Market Update",
        bullets: Array.isArray(v?.bullets) ? v.bullets : [],
        watchlist: Array.isArray(v?.what_to_watch) ? v.what_to_watch : [],
        updatedAt: d.generatedAt,
      };
    }
    d.briefings = { regions: reg };
  }

  d.morningBriefs = d.morningBriefs || d.morning_briefs || {};

  d.macro = d.macro || { updatedAt: null, source: null, regions: {} };
  return d;
}

async function fetchData(){
  const url = "/data.json?t=" + Date.now();
  const r = await fetch(url, { cache:"no-store" });
  const raw = await r.json();
  state.data = normalizeData(raw);
}

function renderNav(){
  const rn = el("regionNav");
  const sn = el("sectorNav");
  rn.innerHTML = "";
  sn.innerHTML = "";

  REGIONS.forEach(r => {
    const b = document.createElement("button");
    b.className = "navItem" + (state.region===r ? " active" : "");
    b.innerHTML = `<span>${esc(REGION_META[r].label)}</span>`;
    b.onclick = () => { state.region = r; renderAll(); };
    rn.appendChild(b);
  });

  SECTORS.forEach(s => {
    const b = document.createElement("button");
    b.className = "navItem" + (state.sector===s ? " active" : "");
    b.innerHTML = `<span>${esc(SECTOR_META[s])}</span>`;
    b.onclick = () => { state.sector = s; renderAll(); };
    sn.appendChild(b);
  });

  el("wireSortLatest").onclick = () => { state.sort="latest"; renderWire(); };
  el("wireSortImpact").onclick = () => { state.sort="impact"; renderWire(); };

  const setMacroTab = (t) => { state.macroTab = t; renderMacro(); };
  el("macroTabMetric").onclick = () => setMacroTab("metric");
  el("macroTabTrend").onclick = () => setMacroTab("trend");
  el("macroTabNext").onclick = () => setMacroTab("next");
}

function filteredWire(region, sector){
  const arr = (state.data?.livewire || []).filter(x => x.region===region);

  if (sector === "GENERAL") {
    // prefer dedicated general items, otherwise mix
    const g = arr.filter(x => x.sector==="GENERAL");
    if (g.length) return g.slice();
    return arr.slice().sort((a,b)=>{
      const ia=impactRank(a.impact), ib=impactRank(b.impact);
      if (ia!==ib) return ib-ia;
      return (safeDate(b.publishedAt)?.getTime()||0)-(safeDate(a.publishedAt)?.getTime()||0);
    }).slice(0,18);
  }

  return arr.filter(x => x.sector===sector).slice();
}

function getDigest(region, sector){
  const d = state.data?.briefings?.regions?.[region]?.[sector];
  if (d) return d;

  const items = filteredWire(region, sector).slice(0,5);
  return {
    title: sector==="GENERAL" ? "Market Update" : `${SECTOR_META[sector]} Update`,
    bullets: items.map(x => x.headline).slice(0,5),
    watchlist: [],
    updatedAt: state.data?.generatedAt || null,
  };
}

function renderBrief(){
  const region = state.region;
  const sector = state.sector;

  el("briefLabel").textContent = (sector==="GENERAL") ? "MORNING BRIEF" : "RANGKUMAN SEKTOR";
  el("briefPath").textContent = `${REGION_META[region].label} / ${SECTOR_META[sector]}`;

  const btn = el("btnOpenBrief");
  const hasBrief = !!state.data?.morningBriefs?.[region]?.slides?.length;
  if (sector==="GENERAL" && hasBrief) btn.classList.remove("hidden");
  else btn.classList.add("hidden");
  btn.onclick = () => openBrief(region);

  if (sector==="GENERAL") {
    const mb = state.data?.morningBriefs?.[region];
    const digest = getDigest(region, "GENERAL");
    el("briefTitle").textContent = mb?.title || digest.title || "Market Update";

    const parts = [];
    if (mb?.lede) parts.push(mb.lede);
    if (Array.isArray(digest?.bullets)) parts.push(...digest.bullets);

    el("briefBullets").innerHTML = parts.slice(0,6).map(t => `<div class="wireKp">• ${esc(t)}</div>`).join("") || `<div class="text-white/55">Menunggu ringkasan terbaru.</div>`;

    const wl = digest?.watchlist || [];
    el("briefWatchlist").innerHTML = wl.length
      ? wl.slice(0,8).map(x => `<div class="text-white/80 text-sm">• ${esc(x)}</div>`).join("")
      : `<div class="text-white/45">—</div>`;
    return;
  }

  const dig = getDigest(region, sector);
  el("briefTitle").textContent = dig.title || `${SECTOR_META[sector]} Update`;
  el("briefBullets").innerHTML = (dig.bullets || []).slice(0,6).map(t => `<div class="wireKp">• ${esc(t)}</div>`).join("") || `<div class="text-white/55">Belum ada poin penting signifikan ≤24 jam.</div>`;
  el("briefWatchlist").innerHTML = (dig.watchlist || []).slice(0,10).map(x => `<div class="text-white/80 text-sm">• ${esc(x)}</div>`).join("") || `<div class="text-white/45">—</div>`;
}

function renderMacro(){
  const region = state.region;
  const tab = state.macroTab || "metric";
  const macro = state.data?.macro?.regions?.[region] || {};
  const rows = (macro?.[tab] || []).slice(0, 8);

  const tabLabel = tab==="metric" ? "METRIK" : (tab==="trend" ? "TREN" : "NEXT");
  el("macroPath").textContent = `${REGION_META[region].label} · ${tabLabel}`;

  el("macroBody").innerHTML = rows.length
    ? rows.map(r => `
        <div class="grid grid-cols-4 gap-2 items-start py-2 border-b border-white/10">
          <div>
            <div class="text-white/80 text-sm font-semibold">${esc(r.metric || "")}</div>
            <div class="text-[.70rem] text-white/45 mt-1">${esc(r.currency || "")}${r.when ? ` · ${esc(r.when)}` : ""}${r.impact ? ` · ${esc(String(r.impact).toUpperCase())}` : ""}</div>
          </div>
          <div class="text-right text-white/85 font-extrabold">${esc(r.previous || "—")}</div>
          <div class="text-right text-white/85 font-extrabold">${esc(r.forecast || "—")}</div>
          <div class="text-right text-white/95 font-extrabold">${esc(r.actual || "—")}</div>
        </div>
      `).join("")
    : `<div class="text-white/45">Tidak ada data macro.</div>`;
}

function renderIndicators(){
  const region = state.region;
  const ind = state.data?.indicators?.[region] || state.data?.indices?.[region] || [];
  const asOf = safeDate(state.data?.generatedAt);
  el("indAsOf").textContent = asOf ? `As of ${asOf.toLocaleString("id-ID",{hour:"2-digit",minute:"2-digit"})}` : "As of —";

  const grid = el("indicatorsGrid");
  grid.innerHTML = "";
  if (!ind.length) {
    grid.innerHTML = `<div class="text-white/45">Indikator belum tersedia.</div>`;
    return;
  }

  ind.slice(0,12).forEach(it => {
    const ch = (typeof it.changePct==="number") ? it.changePct : null;
    const chTxt = ch===null ? "—" : (ch>=0 ? `+${ch.toFixed(2)}%` : `${ch.toFixed(2)}%`);
    const chCls = ch===null ? "text-white/55" : (ch>=0 ? "text-green-300" : "text-red-300");

    const card = document.createElement("div");
    card.className = "rounded-2xl border border-white/10 bg-white/5 p-4";
    card.innerHTML = `
      <div class="text-xs tracking-[.18em] font-extrabold text-white/55">${esc(it.code || "")}</div>
      <div class="mt-1 text-sm text-white/55">${esc(it.name || "")}</div>
      <div class="mt-3 flex items-baseline justify-between">
        <div class="text-[1.15rem] font-extrabold text-white/95">${esc(it.valueFmt || it.value || "—")}</div>
        <div class="text-sm font-extrabold ${chCls}">${esc(chTxt)}</div>
      </div>
    `;
    grid.appendChild(card);
  });
}

function renderWire(){
  const region = state.region;
  const sector = state.sector;
  let items = filteredWire(region, sector);

  if (state.sort==="impact") {
    items.sort((a,b)=>{
      const ia=impactRank(a.impact), ib=impactRank(b.impact);
      if (ia!==ib) return ib-ia;
      return (safeDate(b.publishedAt)?.getTime()||0)-(safeDate(a.publishedAt)?.getTime()||0);
    });
  } else {
    items.sort((a,b)=> (safeDate(b.publishedAt)?.getTime()||0)-(safeDate(a.publishedAt)?.getTime()||0));
  }

  const max = (sector==="GENERAL") ? 18 : 10;
  items = items.slice(0, max);

  el("wireTitle").textContent = `${REGION_META[region].label} / ${SECTOR_META[sector]}`;
  el("wireMeta").textContent = `${items.length} item`;

  const grid = el("wireGrid");
  grid.innerHTML = "";

  if (!items.length) {
    el("wireEmpty").classList.remove("hidden");
    return;
  }
  el("wireEmpty").classList.add("hidden");

  items.forEach(it => {
    const t = safeDate(it.publishedAt);
    const timeTxt = t ? t.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}) : "—";
    const imp = String(it.impact||"MEDIUM").toUpperCase();
    const impCls = imp==="HIGH" ? "impactHigh" : imp==="LOW" ? "impactLow" : "impactMed";

    const kp = (it.keypoints || []).slice(0,3);
    const src = (it.sources||[]).map(s => s?.name).filter(Boolean).slice(0,2).join(" • ");

    const card = document.createElement("div");
    card.className = "wireCard";
    card.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="impactTag ${impCls}">${esc(imp)}</div>
        <div class="text-xs font-extrabold tracking-[.14em] text-white/45">${esc(timeTxt)}</div>
      </div>
      <div class="mt-3 font-extrabold text-[1.05rem] leading-snug">${esc(it.headline)}</div>
      ${kp.length ? `<div class="mt-3 space-y-1">${kp.map(x=>`<div class="wireKp">• ${esc(x)}</div>`).join("")}</div>` : ``}
      ${src ? `<div class="mt-3 text-xs text-white/45 font-semibold">${esc(src)}</div>` : ``}
    `;
    card.onclick = () => openNews(it);
    grid.appendChild(card);
  });
}

function renderTicker(){
  const region = state.region;
  const items = filteredWire(region, "GENERAL").slice(0,12);
  const track = el("tickerTrack");
  const parts = items.map(it => `<span class="mr-4">${esc(it.headline)}</span>`);
  track.innerHTML = parts.join(`<span class="mx-3 opacity-40">•</span>`) || `<span>Menunggu update...</span>`;
}

function renderAll(){
  renderNav();
  renderBrief();
  renderMacro();
  renderIndicators();
  renderWire();
  renderTicker();

  const gen = safeDate(state.data?.generatedAt);
  el("lastUpdated").textContent = gen ? gen.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}) : "—";
}

// ===== Modal =====
const modal = {
  backdrop: el("modalBackdrop"),
  body: el("modalBody"),
  kicker: el("modalKicker"),
  headerRight: el("modalHeaderRight"),
  closeBtn: el("modalCloseBtn"),
};

function showModal(){ modal.backdrop.classList.add("show"); }
function hideModal(){ modal.backdrop.classList.remove("show"); }

function openBrief(region){
  const brief = state.data?.morningBriefs?.[region];
  if (!brief || !Array.isArray(brief.slides) || !brief.slides.length) return;
  state.open = { type:"brief", region };
  renderModal();
}

function openNews(item){
  state.open = { type:"news", item };
  renderModal();
}

function closeModal(){
  state.open = null;
  hideModal();
  modal.body.innerHTML = "";
  modal.kicker.textContent = "";
  modal.headerRight.innerHTML = "";
}

modal.closeBtn.onclick = closeModal;
modal.backdrop.onclick = (e) => { if (e.target === modal.backdrop) closeModal(); };

function renderModal(){
  if (!state.open) return closeModal();
  showModal();

  if (state.open.type === "news"){
    const it = state.open.item;
    modal.kicker.textContent = `${REGION_META[it.region]?.label || it.region} / ${SECTOR_META[it.sector] || it.sector}`;
    modal.headerRight.innerHTML = `<div class="pill">${esc(String(it.impact||"MEDIUM").toUpperCase())}</div>`;

    const srcHtml = (it.sources||[]).slice(0,6).map(s => {
      const u = s?.url ? esc(s.url) : "";
      const n = esc(s?.name || u);
      return u
        ? `<a class="text-xs text-[rgba(245,200,76,.95)] hover:underline" target="_blank" rel="noopener" href="${u}">${n}</a>`
        : `<span class="text-xs text-white/55">${n}</span>`;
    }).join(`<span class="mx-2 opacity-35">•</span>`);

    modal.body.innerHTML = `
      <div class="px-5 py-5">
        <div class="serifTitle text-[2.1rem] font-extrabold leading-tight">${esc(it.headline)}</div>
        ${it.keypoints?.length ? `<div class="mt-4 space-y-2">${it.keypoints.slice(0,6).map(x=>`<div class="wireKp">• ${esc(x)}</div>`).join("")}</div>` : ``}
        ${it.story ? `<div class="mt-5 text-white/80 leading-relaxed">${esc(stripHtml(it.story))}</div>` : ``}
        ${srcHtml ? `<div class="mt-6 pt-4 border-t border-white/10"><div class="text-xs tracking-[.18em] font-extrabold text-white/45">SOURCE</div><div class="mt-2">${srcHtml}</div></div>` : ``}
      </div>
    `;
    return;
  }

  if (state.open.type === "brief"){
    const region = state.open.region;
    const brief = state.data?.morningBriefs?.[region];
    modal.kicker.textContent = `${REGION_META[region].label} • ${brief.asOf || ""}`;
    modal.headerRight.innerHTML = ``;
    modal.body.innerHTML = renderBriefDeck(brief);
    return;
  }
}

function renderBriefDeck(brief){
  const lede = brief?.lede ? `<div class="mt-4 text-white/75 leading-relaxed">${esc(brief.lede)}</div>` : "";
  const slides = (brief?.slides || []).map(s => renderSlide(s)).join("");
  return `
    <div class="px-5 py-5">
      <div class="serifTitle text-[2.3rem] font-extrabold">${esc(brief?.title || "Morning Brief")}</div>
      ${lede}
      <div class="mt-6 space-y-5">${slides}</div>
    </div>
  `;
}

function renderSlide(slide){
  const title = esc(slide?.title || "");
  const type = slide?.type;

  // helper wrappers
  const wrap = (inner) => `
    <div class="card p-5">
      <div class="briefSectionTitle serifTitle">${title}</div>
      <div class="mt-4">${inner}</div>
    </div>
  `;

  if (type === "market_snapshot"){
    const rows = (slide.items || []).map(it => {
      const val = (it.valueFmt || it.value || "—");
      const ch = (typeof it.changePct==="number") ? (it.changePct>=0 ? `+${it.changePct.toFixed(2)}%` : `${it.changePct.toFixed(2)}%`) : "";
      return `
        <div class="flex items-center justify-between py-2 border-b border-white/10">
          <div class="text-white/70 font-semibold">${esc(it.label||"")}</div>
          <div class="text-right">
            <div class="text-white/95 font-extrabold">${esc(val)}</div>
            ${ch ? `<div class="text-xs text-white/55 font-bold">${esc(ch)}</div>` : ``}
          </div>
        </div>
      `;
    }).join("");

    const flow = slide.flow || null;
    let flowBox = "";
    if (flow) {
      const note = flow.miniNote || flow.indexMove || "";
      const fx = flow.foreignNet?.valueFmt || flow.foreignNet?.value || "—";
      const dx = flow.domesticNet?.valueFmt || flow.domesticNet?.value || "—";
      const topBuys = (flow.topBuys || []).slice(0,5).map(x => `<div class="wireKp">• ${esc(x.ticker || "")} ${esc(x.valueFmt || x.value || "")}</div>`).join("");
      const topSells = (flow.topSells || []).slice(0,5).map(x => `<div class="wireKp">• ${esc(x.ticker || "")} ${esc(x.valueFmt || x.value || "")}</div>`).join("");
      const src = (flow.sources || []).slice(0,3).map(s => s?.url ? `<a class="text-xs text-[rgba(245,200,76,.95)] hover:underline" target="_blank" rel="noopener" href="${esc(s.url)}">${esc(s.name||"Source")}</a>` : "").filter(Boolean).join(`<span class="mx-2 opacity-35">•</span>`);
      flowBox = `
        <div class="mt-4 rounded-2xl border border-white/10 bg-white/5 p-4">
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">FLOW</div>
          ${note ? `<div class="mt-2 text-white/80">${esc(note)}</div>` : ``}
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <div class="text-xs tracking-[.18em] font-extrabold text-white/45">RINGKAS</div>
              <div class="mt-2 space-y-1">
                <div class="wireKp">• Foreign Net: ${esc(fx)}</div>
                <div class="wireKp">• Domestic Net: ${esc(dx)}</div>
              </div>
            </div>
            <div>
              <div class="text-xs tracking-[.18em] font-extrabold text-white/45">TOP BUYS / SELLS</div>
              <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>${topBuys || `<div class="text-white/45 text-sm">—</div>`}</div>
                <div>${topSells || `<div class="text-white/45 text-sm">—</div>`}</div>
              </div>
            </div>
          </div>
          ${src ? `<div class="mt-3 pt-3 border-t border-white/10">${src}</div>` : ``}
        </div>`;
    }

    return wrap(`${rows || `<div class="text-white/45">—</div>`}${flowBox}`);
  }

  if (type === "impact_cards"){
    const cards = (slide.cards || []).slice(0,6).map(c => `
      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
        <div class="font-extrabold text-white/90">${esc(c.title || c.headline || "")}</div>
        <div class="mt-2 text-white/75 text-sm leading-relaxed">${esc(c.body || (c.keypoints ? c.keypoints.join(" • ") : ""))}</div>
      </div>
    `).join("");

    return wrap(`
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        ${cards || `<div class="text-white/45">—</div>`}
      </div>
    `);
  }

  if (type === "news_list"){
    const items = (slide.items || []).slice(0,12).map(it => `
      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
        <div class="flex items-center justify-between">
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">${esc(it.category || "")}</div>
          <div class="text-xs text-white/45 font-semibold">${safeDate(it.publishedAt)?.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}) || ""}</div>
        </div>
        <div class="mt-2 font-extrabold text-white/90">${esc(it.headline || "")}</div>
        ${it.keypoints?.length ? `<div class="mt-3 space-y-1">${it.keypoints.slice(0,3).map(x=>`<div class="wireKp">• ${esc(x)}</div>`).join("")}</div>` : ``}
      </div>
    `).join("");

    return wrap(`<div class="space-y-3">${items || `<div class="text-white/45">—</div>`}</div>`);
  }

  if (type === "corporate_actions"){
    const items = (slide.items || []).slice(0,10).map(it => `
      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
        <div class="flex items-center justify-between">
          <div class="font-extrabold text-white/90">${esc(it.ticker||"")}</div>
          <div class="text-xs text-white/55 font-semibold">${esc(it.company||"")}</div>
        </div>
        <div class="mt-2 text-white/80 text-sm leading-relaxed">${esc(it.action || it.summary || "")}</div>
      </div>
    `).join("");

    return wrap(`<div class="space-y-3">${items || `<div class="text-white/45">—</div>`}</div>`);
  }

  if (type === "top_movers"){
    const col = (title, arr, sign) => `
      <div>
        <div class="text-xs tracking-[.18em] font-extrabold text-white/45">${esc(title)}</div>
        <div class="mt-2 space-y-2">
          ${(arr||[]).slice(0,3).map(it => `
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="flex items-center justify-between">
                <div class="font-extrabold text-white/90">${esc(it.ticker||"")}</div>
                <div class="text-sm font-extrabold text-white/80">${esc(sign)}${esc((it.changePct ?? "—"))}${(typeof it.changePct==="number")?"%":""}</div>
              </div>
              ${it.why ? `<div class="mt-2 text-white/70 text-sm">${esc(it.why)}</div>` : ``}
            </div>
          `).join("")}
        </div>
      </div>
    `;
    return wrap(`
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        ${col("GAINERS", slide.gainers, "+")}
        ${col("LOSERS", slide.losers, "")}
      </div>
    `);
  }

  if (type === "macro_rates_fx"){
    const rows = (slide.items||[]).map(it => `
      <div class="flex items-center justify-between py-2 border-b border-white/10">
        <div class="text-white/70 font-semibold">${esc(it.label||"")}</div>
        <div class="text-white/95 font-extrabold">${esc(it.valueFmt || it.value || "—")}</div>
      </div>
    `).join("");
    const interp = (slide.interpretation||[]).slice(0,6).map(x=>`<div class="wireKp">• ${esc(x)}</div>`).join("");
    return wrap(`${rows || `<div class="text-white/45">—</div>`}${interp ? `<div class="mt-4 space-y-1">${interp}</div>` : ""}`);
  }

  if (type === "etf_flows"){
    const rows = (arr) => (arr||[]).slice(0,3).map(it=>`
      <div class="flex items-center justify-between py-2 border-b border-white/10">
        <div class="text-white/70 font-semibold">${esc(it.symbol||"")}</div>
        <div class="text-white/95 font-extrabold">${esc(it.flowUsdFmt || it.flowUsd || "—")}</div>
      </div>
    `).join("");

    return wrap(`
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">INFLOWS</div>
          <div class="mt-2">${rows(slide.inflows) || `<div class="text-white/45">—</div>`}</div>
        </div>
        <div>
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">OUTFLOWS</div>
          <div class="mt-2">${rows(slide.outflows) || `<div class="text-white/45">—</div>`}</div>
        </div>
      </div>
    `);
  }

  if (type === "sector_cards"){
    const items = (slide.items||[]).slice(0,6).map(it => `
      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
        <div class="font-extrabold text-white/90">${esc(SECTOR_META[it.sector] || it.sector || "")}</div>
        <div class="mt-2 text-white/70 text-sm">${esc(it.note || "")}</div>
      </div>
    `).join("");
    return wrap(`<div class="grid grid-cols-1 md:grid-cols-3 gap-3">${items || `<div class="text-white/45">—</div>`}</div>`);
  }

  if (type === "watchlist_playbook"){
    const wl = (slide.watchlist||[]).slice(0,10).map(it => {
      if (typeof it === "string") return `<div class="wireKp">• ${esc(it)}</div>`;
      return `<div class="wireKp">• ${esc(it.ticker || "")}${it.why ? ` — ${esc(it.why)}` : ""}</div>`;
    }).join("");
    const act = (slide.playbook || slide.actions || []).slice(0,10).map(x => `<div class="wireKp">• ${esc(x)}</div>`).join("");
    const disc = slide.disclaimer ? `<div class="mt-4 text-white/45 text-xs">${esc(slide.disclaimer)}</div>` : "";
    return wrap(`
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">WATCHLIST</div>
          <div class="mt-2 space-y-1">${wl || `<div class="text-white/45">—</div>`}</div>
        </div>
        <div>
          <div class="text-xs tracking-[.18em] font-extrabold text-white/45">PLAYBOOK</div>
          <div class="mt-2 space-y-1">${act || `<div class="text-white/45">—</div>`}</div>
        </div>
      </div>
      ${disc}
    `);
  }

  
  if (type === "deep_dive"){
    const it = slide.item || {};
    const bullets = (it.bullets || []).slice(0,6).map(x=>`<div class="wireKp">• ${esc(x)}</div>`).join("");
    const src = (it.sources||[]).slice(0,1).map(s => s?.url ? `<a class="text-xs text-[rgba(245,200,76,.95)] hover:underline" target="_blank" rel="noopener" href="${esc(s.url)}">${esc(s.name||"Source")}</a>` : "").join("");
    return wrap(`
      <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
        <div class="font-extrabold text-white/90">${esc(it.headline || "")}</div>
        ${it.body ? `<div class="mt-2 text-white/75 text-sm leading-relaxed">${esc(it.body)}</div>` : ``}
        ${bullets ? `<div class="mt-3 space-y-1">${bullets}</div>` : ``}
        ${src ? `<div class="mt-3">${src}</div>` : ``}
      </div>
    `);
  }

return wrap(`<div class="text-white/60">Slide type tidak didukung: ${esc(type)}</div>`);
}

async function boot(){
  try{
    await fetchData();
    renderAll();
  }catch(e){
    console.error(e);
    el("wireEmpty").classList.remove("hidden");
    el("wireEmpty").textContent = "Gagal memuat data.json";
  }
}

el("btnReconnect").onclick = async () => { await fetchData(); renderAll(); };

boot();
</script>

</body>
</html>
